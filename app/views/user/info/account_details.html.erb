<style type="text/css">
    .table{
        width: 90%;
        margin: auto;
    }


    #haveDiv div{
      display: none;
    }

</style>

<%= title '易积分收支明细' %>

<div class='wallet'>
  <div class="weui-flex profile">
    <div>
      <div class="placeholder">
        <%= image_tag current_user.headimgurl if current_user && current_user.headimgurl %>
      </div>
    </div>
    <div class="weui-flex__item profile-text">
      <div class="placeholder"><%= current_user.nickname %></div>
    </div>
  </div>
  <div class="weui-flex middle-text">
    <div class="weui-flex__item"><div class="placeholder text-center">账户资产</div></div>
  </div>
  <div class="weui-flex bottom-text">

    <% integral = Integral.find_by(user_id: current_user.user_id) %>

    <div class="weui-flex__item">
      <div class="placeholder text-center">
        <a class="weui-cell_access">
          <p class="btnTab">可使用</p>
          <p><%= integral.available || 0 %></p>
        </a>
      </div>
    </div>

    <div class="weui-flex__item">
      <div class="placeholder text-center">
        <a  class="weui-cell_access">
          <p class="btnTab">可赠送</p>
          <p><%= integral.exchange || 0 %></p>
        </a>
      </div>
    </div>

    <div class="weui-flex__item">
      <div class="placeholder text-center">
        <a class="weui-cell_access">
          <p class="btnTab">可增值</p>
          <p><%= integral.appreciation || 0 %></p>
        </a>
      </div>
    </div>

    <!-- <div class="weui-flex__item">
      <div class="placeholder text-center">
        <a class="weui-cell_access">
          <p class="btnTab">锁定</p>
          <p><%= integral.locking || 0 %></p>
        </a>
      </div>
    </div> -->

  </div>
</div>

<div id="haveDiv">
  <div style="display: block;  padding-bottom:3.5rem;" class="weui-cells__title"> 可使用收支明细：
    <table class="table">
        <thead>
            <tr>
                <td class="td">姓名</td>
                <td class="td">收入支出渠道</td>
                <td class="td">数量</td>
                <td class="td">时间</td>
            </tr>
        </thead>
        <% details = PresentedRecord.where(user_id: current_user.user_id).where(type: "Available").order(created_at: :desc).limit(10) %>
        <% if details.length >= 1 %>
          <tbody>
            <% details.each do |details| %>
              <% if !details.nil? %>
                <tr class="center">
                    <td class="td" style="width: 20%"><%= details.user.name %></td>
                    <td class="td" style="width: 30%"><%= details.reason %></td>
                    <td class="td" style="width: 15%"><%= details.number %></td>
                    <% if details.is_effective == true %>
                      <% value = "No" %>
                    <% end %>
                    <td class="td" style="width: 25%"><%= date details.created_at %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        <% end %>
    </table>
  </div>
  <div class="weui-cells__title" style="padding-bottom:3.5rem;">可赠送收支明细：
    <table class="table">
        <thead>
            <tr>
                <td class="td">姓名</td>
                <td class="td">收入支出渠道</td>
                <td class="td">数量</td>
                <td class="td">时间</td>
            </tr>
        </thead>
        <% details = PresentedRecord.where(user_id: current_user.user_id).where(type: "Exchange").order(created_at: :desc).limit(10) %>
        <% if details.length >= 1 %>
          <tbody>
            <% details.each do |details| %>
              <% if !details.nil? %>
                <tr class="center">
                    <td class="td" style="width: 20%"><%= details.user.name %></td>
                    <td class="td" style="width: 30%"><%= details.reason %></td>
                    <td class="td" style="width: 15%"><%= details.number %></td>
                    <% if details.is_effective == true %>
                      <% value = "No" %>
                    <% end %>
                    <td class="td" style="width: 25%"><%= date details.created_at %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        <% end %>
    </table>
  </div>
  <div class="weui-cells__title" style="padding-bottom:3.5rem;">可增值收支明细：
    <table class="table">
        <thead>
            <tr>
                <td class="td">姓名</td>
                <td class="td">收入支出渠道</td>
                <td class="td">数量</td>
                <td class="td">时间</td>
            </tr>
        </thead>
        <% details = PresentedRecord.where(user_id: current_user.user_id).where(reason: "购买产品返还积分").order(created_at: :desc).limit(10) %>
        <% if details.length >= 1 %>
          <tbody>
            <% details.each do |details| %>
              <% if !details.nil? %>
                <tr class="center">
                    <td class="td" style="width: 20%"><%= details.user.name %></td>
                    <td class="td" style="width: 30%"><%= details.reason %></td>
                    <td class="td" style="width: 15%"><%= details.number %></td>
                    <% if details.is_effective == true %>
                      <% value = "No" %>
                    <% end %>
                    <td class="td" style="width: 25%"><%= date details.created_at %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        <% end %>
    </table>
  </div>
  <div class="weui-cells__title" style="padding-bottom:3.5rem;">锁定收支明细：
    <table class="table">
        <thead>
            <tr>
                <td class="td">姓名</td>
                <td class="td">收入支出渠道</td>
                <td class="td">数量</td>
                <td class="td">时间</td>
            </tr>
        </thead>
        <% details = PresentedRecord.where(user_id: current_user.user_id).where(type: "Locking").order(created_at: :desc).limit(10) %>
        <% if details.length >= 1 %>
          <tbody>
            <% details.each do |details| %>
              <% if !details.nil? %>
                <tr class="center">
                    <td class="td" style="width: 20%"><%= details.user.name %></td>
                    <td class="td" style="width: 30%"><%= details.reason %></td>
                    <td class="td" style="width: 15%"><%= details.number %></td>
                    <% if details.is_effective == true %>
                      <% value = "No" %>
                    <% end %>
                    <td class="td" style="width: 25%"><%= date details.created_at %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        <% end %>
    </table>
  </div>
</div>
<script type="text/javascript">

  var oTab=document.getElementsByClassName("btnTab");
  //这里获取了全部的div,所以后面套数据时候的布局不要使用div
  var oDiv=document.getElementById('haveDiv').getElementsByTagName("div");

  // console.log(oTab.length);

 for(var i=0;i<oTab.length;i++){

    oTab[i].index=i;
    oTab[i].onclick=function(){

      for(var j=0;j<oDiv.length;j++){

       oDiv[j].style.display = "none"//隐藏所有的tabDiv
      }
      oDiv[this.index].style.display = "block";

    }

  }


</script>


<div style="margin-top: 10px;display: flex;position: fixed;width: 100%;bottom: 58px;height:7%;">
  <a class="button-zs" href="<%= user_gift_path %>">赠送</a>
  <!-- <a class="button-dh" href="<%= user_exchange_path %>">兑换</a> -->
</div>


<style>
.weui-tab__panel {
  background-color: #EAE8E8;
}
</style>
